.TH HKDF 2
.SH NAME
hkdfExpand, hkdfExtract, hkdfKey \- HMAC-based extract-and-expand key derivation function (HKDF)
.SH SYNOPSIS
.nr Wd \w'\fLvoid \fP'u
.nr In \w'\fLvoid  \fP'u
.ta \n(Wdu \w'\fLSHA1state* \fP'u +\n(Wdu +\n(Wdu +\n(Wdu +\n(Wdu
.
.de Ti
.PP
.in +\\n(Inu
.ti -\\n(Inu
.B
.nh
..
.
.ft L
.nf
#include <u.h>
#include <libc.h>
#include <libsec.h>
#define DS DigestState	/* only to abbreviate SYNOPSIS */
.fi
.Ti
int hkdfExpand(uchar *out, DS*(*x)(uchar*, ulong, uchar*, DS*), int xlen, uchar *prk, int nprk, uchar *info, int ninfo, int keylen)
.Ti
void hkdfExtract(uchar *out, DS*(*x)(uchar*, ulong, uchar*, DS*), int xlen, uchar *secret, int nsecret, uchar *salt, int nsalt)
.Ti
int hkdfKey(uchar *out, DS*(*x)(uchar*, ulong, uchar*, DS*), int xlen, uchar* secret, int nsecret, uchar* salt, int nsalt, uchar *info, int ninfo, int keylen)
.SH DESCRIPTION
.I hkdfExpand
derives a key from the given
.IR x
.IR sechash(2)
function, pseudo random key
.IR prk ,
and optional context
.IR info ,
returning a byte array in
.IR out
of length
.IR keylen
that can be used as cryptographic key.
The extraction step is skipped.
.PP
The key should have been generated by
.IR hkdfExtract ,
or be a uniformly
random or pseudorandom cryptographically strong key.
See RFC 5869,
Section 3.3.
Most common scenarios will want to use
.IR hkdfKey
instead.
.PP
.I hkdfExtract
generates a pseudorandom key in
.IR out
for use with
.IR hkfExpand
from an input
.IR secret
and an optional independent
.IR salt .
.PP
Only use this function if you need to reuse the extracted key with multiple
Expand invocations and different context values. Most common scenarios,
including the generation of multiple keys, should use
.IR hkdfKey
instead.
.PP
.I hkdfKey
derives a key from the given
.IR x
.IR sechash(2)
function,
.IR secret ,
.IR salt
and context
.IR info ,
returning a byte array in
.IR out
of length 
.IR keylen
that can be used as cryptographic key.
.PP
.IR Salt
and
.IR info
may be
.BR nil .
.SH SOURCE
.B /sys/src/libsec
.SH SEE ALSO
.IR sechash (2)
.br
RFC 5869
.SH DIAGNOSTICS
These functions set
.IR errstr .
